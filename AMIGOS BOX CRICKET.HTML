<!DOCTYPE html>
<html>
<head>
<title>AMIGOS BOX CRICKET</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0b1d0b;color:white;}
header{background:linear-gradient(90deg,#0f3d1e,#1faa00);padding:15px;text-align:center;font-size:20px;font-weight:bold;}
.container{padding:15px;max-width:600px;margin:auto;}
.card{background:#122a12;border:1px solid #1faa00;padding:15px;border-radius:12px;margin-bottom:15px;}
h3{margin-top:0;color:#7CFC00;}
input,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none;}
button{width:100%;padding:10px;border:none;border-radius:8px;font-weight:bold;margin-top:8px;cursor:pointer;}
.primary{background:#1faa00;color:white;}
.danger{background:#cc0000;color:white;}
.admin{background:#ffcc00;color:black;}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:6px;}
.slot{padding:8px;text-align:center;border-radius:6px;font-size:12px;cursor:pointer;color:white;}
.slot.selected{background:#00bfff;} 
.slot.accepted{background:#1faa00;} 
.slot.pending{background:#ffcc00;color:black;} 
.slot.denied{background:#cc0000;} 
.bookingItem{background:#0f1f11;padding:6px;border-radius:6px;margin:4px 0;font-size:12px;}
.customerCard{background:#0f2a0f;padding:10px;border-radius:10px;margin-bottom:8px;}
.hidden{display:none;}
.legend{display:flex;justify-content:space-around;margin-bottom:6px;}
.legend div{padding:6px;border-radius:6px;font-size:12px;text-align:center;color:black;}
.legend .accepted{background:#1faa00;color:white;} 
.legend .selected{background:#00bfff;color:white;}
.legend .pending{background:#ffcc00;color:black;}
.legend .denied{background:#cc0000;color:white;}
</style>
</head>
<body>
<header>üèè AMIGOS BOX CRICKET</header>
<div class="container">

<div id="login" class="card">
<h3>Login</h3>
<input id="name" placeholder="Enter Name">
<input id="mobile" placeholder="Enter Mobile (+91...)">
<input type="password" id="ownerPin" placeholder="Enter Owner PIN" style="display:none;">
<button class="primary" onclick="loginUser()">Login</button>
</div>

<div id="main" class="hidden">
<div class="card">
<h3 id="welcome"></h3>
<button class="danger" onclick="logout()">Logout</button>
<button id="adminBtn" class="admin hidden" onclick="showAdmin()">Owner Dashboard</button>
</div>

<div id="customerPanel">
  <div class="card">
    <h3>Select Date</h3>
    <input type="date" id="date" onchange="loadSlots()">
  </div>

  <div class="card">
    <h3>Legend</h3>
    <div class="legend">
      <div class="accepted">Accepted</div>
      <div class="selected">Selected</div>
      <div class="pending">Pending</div>
      <div class="denied">Denied</div>
    </div>
  </div>

  <div class="card">
    <h3>Select Time Slots (Hours only)</h3>
    <div class="grid" id="slotGrid"></div>
  </div>

  <div class="card" id="paymentSection">
    <h3>Select UPI App</h3>
    <select id="upiApp">
      <option value="paytm">Paytm</option>
      <option value="phonepe">PhonePe</option>
      <option value="googlepay">Google Pay</option>
      <option value="bhim">BHIM</option>
      <option value="other">Other UPI</option>
    </select>
    <button class="primary" onclick="payNow()">Pay & Confirm Booking</button>
  </div>

  <div id="ownerBookSection" class="card hidden">
    <h3>Book Free Slot (Owner)</h3>
    <button class="primary" onclick="ownerBook()">Book Free Slot</button>
  </div>

  <div class="card">
    <h3>Your Booked Slots</h3>
    <div id="myBookings"></div>
  </div>
</div>

<div id="adminPanel" class="card hidden">
<h3>üìä Owner Dashboard</h3>
<button class="danger" onclick="closeAdmin()">Close</button>
<button class="danger" onclick="restartBookings()">Restart All Bookings</button>
<div id="stats"></div>
<h3>All Customers & Bookings</h3>
<div id="allCustomers"></div>
</div>

</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const OWNER_NUMBER="9441666333";
const OWNER_PIN="6122";
const UPI_ID="shashikokkula@ybl";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let currentUser=null;
let selectedSlots=[];

// Owner PIN visibility
document.getElementById("mobile").addEventListener("input",function(){
  const mobile=this.value.replace(/\D/g,"").slice(-10);
  document.getElementById("ownerPin").style.display=(mobile===OWNER_NUMBER)?"block":"none";
});

async function loginUser(){
  const name=document.getElementById("name").value.trim();
  const mobile=document.getElementById("mobile").value.replace(/\D/g,"").slice(-10);
  const pin=document.getElementById("ownerPin").value.trim();
  if(!name||!mobile){alert("Enter Name & Mobile");return;}
  let role="customer";
  if(mobile===OWNER_NUMBER && pin===OWNER_PIN) role="owner";

  currentUser={name, mobile, role};
  document.getElementById("login").classList.add("hidden");
  document.getElementById("main").classList.remove("hidden");
  document.getElementById("welcome").innerText=`Welcome ${name} (${role.toUpperCase()})`;
  if(role==="owner"){
    document.getElementById("adminBtn").classList.remove("hidden");
    document.getElementById("paymentSection").style.display="none";
    document.getElementById("ownerBookSection").classList.remove("hidden");
  }
  loadMyBookings();
  loadSlots();
}

// LOGOUT
function logout(){ location.reload(); }

// LOAD SLOTS
async function loadSlots(){
  const date=document.getElementById("date").value || new Date().toISOString().split("T")[0];
  document.getElementById("date").value=date;
  selectedSlots=[];
  const grid=document.getElementById("slotGrid");
  grid.innerHTML="";

  const snapshot = await db.collection("bookings").where("date","==",date).get();
  const bookings=snapshot.docs.map(d=>d.data());

  const now=new Date();
  const ISTOffset=5.5*60;
  const utc=now.getTime()+now.getTimezoneOffset()*60000;
  const istTime=new Date(utc + ISTOffset*60000);
  const currentHour=istTime.getHours();
  const todayStr=istTime.toISOString().split("T")[0];

  for(let i=0;i<24;i++){
    const div=document.createElement("div");
    div.className="slot";
    let price=(i>=6 && i<18)?500:600;
    div.innerText=i+":00 ‚Çπ"+price;
    const booking=bookings.find(b=>b.start===i);
    if(booking){
      div.classList.add(booking.type==="denied"?"denied":booking.type==="pending"?"pending":"accepted");
    } else if(date===todayStr && i<=currentHour){div.classList.add("denied");}

    div.onclick=function(){
      if(div.classList.contains("accepted")||div.classList.contains("pending")||div.classList.contains("denied")) return;
      div.classList.toggle("selected");
      if(div.classList.contains("selected")) selectedSlots.push(i);
      else selectedSlots=selectedSlots.filter(x=>x!==i);
    }
    grid.appendChild(div);
  }
}

// PAY NOW
function payNow(){
  if(selectedSlots.length===0){alert("Select slots");return;}
  const date=document.getElementById("date").value;
  const amount=selectedSlots.reduce((sum,h)=>sum+((h>=6 && h<18)?500:600),0);
  const app=document.getElementById("upiApp").value;
  let upiUri="";
  switch(app){
    case "paytm": upiUri=`https://paytm.me/${UPI_ID}/${amount}`; break;
    case "phonepe": upiUri=`phonepe://upi/pay?pa=${UPI_ID}&pn=AMIGOSBOX&am=${amount}&cu=INR`; break;
    case "googlepay": upiUri=`upi://pay?pa=${UPI_ID}&pn=AMIGOSBOX&am=${amount}&cu=INR`; break;
    case "bhim": upiUri=`upi://pay?pa=${UPI_ID}&pn=AMIGOSBOX&am=${amount}&cu=INR`; break;
    default: upiUri=`upi://pay?pa=${UPI_ID}&pn=AMIGOSBOX&am=${amount}&cu=INR`;
  }
  window.location.href=upiUri;
  setTimeout(()=>{ confirmBooking(date,"paid"); },10000);
}

// OWNER FREE BOOK
async function ownerBook(){
  const date=document.getElementById("date").value;
  for(const hour of selectedSlots){
    await db.collection("bookings").add({user:OWNER_NUMBER,name:"OWNER",date:date,start:hour,amount:0,type:"free"});
  }
  selectedSlots=[];
  alert("‚úÖ Free Slot Booked!");
  loadSlots();
  loadMyBookings();
}

// CONFIRM BOOKING
async function confirmBooking(date,type="paid"){
  for(const hour of selectedSlots){
    let price=(hour>=6 && hour<18)?500:600;
    if(type==="free") price=0;
    await db.collection("bookings").add({user:currentUser.mobile,name:currentUser.name,date:date,start:hour,amount:price,type:type});
  }
  alert("‚úÖ Booking Confirmed ("+type.toUpperCase()+")");
  selectedSlots=[];
  loadSlots();
  loadMyBookings();
}

// LOAD MY BOOKINGS
async function loadMyBookings(){
  const div=document.getElementById("myBookings");
  div.innerHTML="";
  const snapshot=await db.collection("bookings").where("user","==",currentUser.mobile).get();
  snapshot.docs.forEach(doc=>{
    const b=doc.data();
    div.innerHTML+=`<div class="bookingItem">${b.date} | ${b.start}:00 | ‚Çπ${b.amount} | ${b.type}</div>`;
  });
}

// ADMIN DASHBOARD
async function showAdmin(){
  if(currentUser.mobile!==OWNER_NUMBER) return;
  document.getElementById("adminPanel").classList.remove("hidden");
  const snapshot=await db.collection("bookings").get();
  const bookings=snapshot.docs.map(d=>({id:d.id,...d.data()}));
  let totalRevenue=bookings.reduce((s,b)=>s+b.amount,0);
  let freeCount=bookings.filter(b=>b.type==="free").length;
  let deniedCount=bookings.filter(b=>b.type==="denied").length;
  document.getElementById("stats").innerHTML=`<p>Total Revenue: ‚Çπ${totalRevenue}</p><p>Free Slots: ${freeCount}</p><p>Denied Slots: ${deniedCount}</p>`;
  const allDiv=document.getElementById("allCustomers");
  allDiv.innerHTML="";
  bookings.forEach((b)=>{
    allDiv.innerHTML+=`<div class="customerCard"><b>${b.name} (${b.user})</b><br>${b.date} | ${b.start}:00 | ‚Çπ${b.amount} | ${b.type}<br>
    ${b.type!=="free"?`<button onclick="acceptBooking('${b.id}')">Accept</button> <button onclick="denyBooking('${b.id}')">Deny</button>`:""}</div>`;
  });
}

// ACCEPT / DENY
async function acceptBooking(id){await db.collection("bookings").doc(id).update({type:"paid"}); showAdmin(); loadSlots(); loadMyBookings();}
async function denyBooking(id){await db.collection("bookings").doc(id).update({type:"denied"}); showAdmin(); loadSlots(); loadMyBookings();}

// RESTART ALL BOOKINGS
async function restartBookings(){
  if(currentUser.mobile!==OWNER_NUMBER){alert("Only owner can restart!"); return;}
  if(confirm("‚ö†Ô∏è Delete ALL bookings?")) {
    const snapshot=await db.collection("bookings").get();
    snapshot.docs.forEach(d=>d.ref.delete());
    alert("‚úÖ All bookings cleared!");
    loadSlots(); loadMyBookings(); showAdmin();
  }
}

function closeAdmin(){document.getElementById("adminPanel").classList.add("hidden");}

</script>
</body>
</html>
